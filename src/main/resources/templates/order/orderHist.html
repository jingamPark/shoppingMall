<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <title>주문이력</title>



</head>
<body>

    <div layout:fragment="content" >
        <h2>주문이력</h2>

        <div th:each="order : ${orders.getContent()}">

            <div class="align-self-center d-flex mb-3">
                <h4 th:text="${order.orderDate} + ' 주문'"></h4>
                <div class="ml-3">
                    <th:block th:if="${order.orderStatus.name == 'ORDER'}">
                        <button type="button" class="btn btn-outline-secondary cancelOrder " th:value="${order.orderId}" >
                            주문 취소
                        </button>
                    </th:block>
                    <th:block th:unless="${order.orderStatus.name == 'ORDER'}">
                        <h4>(취소완료)</h4>
                    </th:block>
                </div>
            </div>
            <div class="card d-flex">
                <div th:each="orderProduct : ${order.orderProductDTOList}" class="d-flex mb-3">
                    <div class="repImgDiv">
                        <img th:src="${orderProduct.imgUrl}" class="rounded repImg" th:alt="${orderProduct.prodName}">
                    </div>

                    <div class="align-self-center w-75">
                        <span th:text="'상품명 : '+${orderProduct.prodName}"></span><br>
                        <span th:text="'가격 : ' + ${orderProduct.orderPrice}+ '원'"></span><br>
                        <span th:text="'주문 수량 : ' + ${orderProduct.count}+ '개'"></span>
                    </div>

                </div>

            </div>

        </div>

        <div class="row justify-content-center" th:with="start=${(orders.number/maxPage) * maxPage + 1 } , end=${(orders.totalPages==0 ) ? 1 :  (start + (maxPage -1) < orders.totalPages ? start + (maxPage - 1): orders.totalPages) }">
            <div class="col-4">
                <ul class="pagination">
                    <!--이전-->
                    <li class="page-item" th:classappend="${orders.first} ? 'disabled' : ''">
                        <a class="page-link"   th:href="@{'/orders/' + ${orders.number - 1}}">Previous</a>
                    </li>

                    <!--반복-->
                    <li class="page-item" th:each="page: ${#numbers.sequence(start,end)}"  th:classappend="${orders.number eq page - 1} ? 'active' : ''">
                        <a  th:href="@{'/orders/' + ${page -1}}" class="page-link" >[[${page}]]</a>
                    </li>

                    <!--다음-->
                    <li class="page-item" th:classappend="${orders.last} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{'/orders/' + ${orders.number + 1}}">Next</a>
                    </li>
                </ul>
            </div>
        </div>



        <script th:inline="javascript">


            $(document).ready(function () {

                $(".cancelOrder").on("click", function (e) {

                    let orderId = $(this).val();
                    let url = "/order/" + orderId + "/cancel"
                    let paramData ={
                        orderId : orderId
                    }
                    $.ajax({
                        url : url,
                        type : "post",
                        dataType : "json",
                        success: function () {
                            alert("성공")
                            location.href = "/orders/" +[[${page}]]
                        },
                        error: function () {
                            alert("실패")
                        },

                    })

                });


            });







        </script>
    </div> <!--content-->




</body>
</html>